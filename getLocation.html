<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Location Tracking</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="container mt-5">
      <h1>Location Tracking</h1>
      <a href="index.html">Go Back</a> <br>
      <button class="geo-btn btn btn-primary mt-3">Start Location Tracking</button>
      <div id="showDetails" class="mt-3">Loc details:</div>
      <div id="latmean" class="mt-3"></div>
      <div id="longmean" class="mt-3"></div>
      
      <table id="coordtable" class="table mt-3">
        <thead>
          <tr>
            <th>Count</th>
            <th>Latitude</th>
            <th>Longitude</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      let latitudes = [];
      let longitudes = [];
      let n = 0; // To track number of location points
      let interval; // To store interval ID for clearing after 10 seconds

      document.querySelector(".geo-btn").addEventListener("click", () => {
        if (navigator.geolocation) {
          latitudes = []; // Clear previous data
          longitudes = []; // Clear previous data
          n = 0; // Reset counter

          // Start collecting location data for 10 seconds
          interval = setInterval(() => {
            navigator.geolocation.getCurrentPosition(successCallback, errorCallback, options);
          }, 1000); // Collect every 1 second

          // Stop collection after 10 seconds
          setTimeout(() => {
            clearInterval(interval);
            calculateMean(); // After 10 seconds, compute and display the mean
          }, 10000); // 10 seconds window
        }
      });

      const successCallback = (position) => {
        n++;
        console.log(`lat:${position.coords.latitude}`);
        console.log(`long:${position.coords.longitude}`);
        console.log(`accuracy:${position.coords.accuracy} meters`);
        console.log(`altitude:${position.coords.altitude} meters`);

        // Update the details display
        showDetails.innerHTML =
          "accuracy : " + position.coords.accuracy + "<br>";
        showDetails.innerHTML +=
          "Latitude : " + position.coords.latitude + "<br>";
        showDetails.innerHTML +=
          "Longitude : " + position.coords.longitude + "<br>";
        showDetails.innerHTML +=
          "altitude : " + position.coords.altitude + "<br>";

        // Store the coordinates for averaging
        latitudes.push(position.coords.latitude);
        longitudes.push(position.coords.longitude);

        // Update the table with the latest coordinates
        const coordtable = document.getElementById("coordtable").getElementsByTagName("tbody")[0];
        var row = coordtable.insertRow();
        row.insertCell(0).textContent = n;
        row.insertCell(1).textContent = position.coords.latitude;
        row.insertCell(2).textContent = position.coords.longitude;
      };

      const errorCallback = (error) => {
        console.log(error.message);
      };

      const options = {
        enableHighAccuracy: true,
        timeout: 1000, // 1 second
        maximumAge: 100,
      };

      const calculateMean = () => {
        if (latitudes.length === 0 || longitudes.length === 0) return;

        // Calculate the mean latitude and longitude
        const latSum = latitudes.reduce((partialSum, a) => partialSum + a, 0);
        const longSum = longitudes.reduce((partialSum, a) => partialSum + a, 0);
        const latMean = latSum / latitudes.length;
        const longMean = longSum / longitudes.length;

        // Display the computed mean coordinates
        latmean.innerHTML = "Mean Latitude: " + latMean.toFixed(6);
        longmean.innerHTML = "Mean Longitude: " + longMean.toFixed(6);

        console.log(`Mean Latitude: ${latMean}, Mean Longitude: ${longMean}`);
      };
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
