<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Location</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container text-center mt-5">
    <a href="index.html" class="btn btn-secondary">Go Back</a>
    <h2 class="mt-3">GPS Location Tracker</h2>
    
    <button class="geo-btn btn btn-success mt-3">Start Collecting Location</button>
    
    <p id="timer" class="mt-3">Time Left: 10s</p>
    <div id="showDetails" class="mt-3">Location details will appear here...</div>
    
    <h4 class="mt-3">Mean Coordinates</h4>
    <p id="latmean"></p>
    <p id="longmean"></p>

    <script>
        let latitudes = [];
        let longitudes = [];
        let n = 0;
        let countdown = 10;
        let timerInterval;

        document.querySelector(".geo-btn").addEventListener("click", () => {
            latitudes = [];
            longitudes = [];
            n = 0;
            countdown = 10;

            document.getElementById("timer").innerHTML = `Time Left: ${countdown}s`;
            document.getElementById("latmean").innerHTML = "";
            document.getElementById("longmean").innerHTML = "";
            document.getElementById("showDetails").innerHTML = "Collecting GPS data...";

            if (navigator.geolocation) {
                timerInterval = setInterval(() => {
                    if (countdown > 0) {
                        countdown--;
                        document.getElementById("timer").innerHTML = `Time Left: ${countdown}s`;
                        navigator.geolocation.getCurrentPosition(successCallback, errorCallback, options);
                    } else {
                        clearInterval(timerInterval);
                        calculateMean();
                    }
                }, 1000); // Run every second
            }
        });

        const successCallback = (position) => {
            let latitude = parseFloat(position.coords.latitude.toFixed(8));
            let longitude = parseFloat(position.coords.longitude.toFixed(8));

            latitudes.push(latitude);
            longitudes.push(longitude);
            n++;

            document.getElementById("showDetails").innerHTML = `
                Samples Collected: ${n} <br>
                Latest Latitude: ${latitude} <br>
                Latest Longitude: ${longitude} <br>
                Accuracy: ${position.coords.accuracy.toFixed(2)} meters
            `;

            console.log(`Sample ${n}: Lat: ${latitude}, Long: ${longitude}`);
        };

        const calculateMean = () => {
            if (n === 0) {
                document.getElementById("latmean").innerHTML = "No data collected.";
                document.getElementById("longmean").innerHTML = "";
                return;
            }

            const latSum = latitudes.reduce((sum, a) => sum + a, 0);
            const longSum = longitudes.reduce((sum, a) => sum + a, 0);
            const latMean = (latSum / n).toFixed(8);
            const longMean = (longSum / n).toFixed(8);

            document.getElementById("latmean").innerHTML = `Mean Latitude: ${latMean}`;
            document.getElementById("longmean").innerHTML = `Mean Longitude: ${longMean}`;

            console.log(`Mean Latitude: ${latMean}`);
            console.log(`Mean Longitude: ${longMean}`);
        };

        const errorCallback = (error) => {
            console.log(error.message);
            document.getElementById("showDetails").innerHTML = "Error: Unable to get location.";
        };

        const options = {
            enableHighAccuracy: true,
            timeout: 1000,
            maximumAge: 100,
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
</body>
</html>
